<head>
    <link rel="stylesheet" href="university_search_subpages_style.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/search" class="active">Universities</a></li>
            <li><a href="/review">Reviews</a></li>
            <li><a href="/calculator">Calculator</a></li>
            <li class="profile-menu">
                <img src="/profile.png" alt="Profile" class="profile-icon">
                <div class="dropdown">
                    <button>Profile</button>
                    <button>Settings</button>
                    <form action="/login" method="post"><button type="submit">Logout</button></form>
                </div>
            </li>
        </ul>
    </nav>

    <% const name = data4[0].university_name; %>
    <% const admissionAvg = data4[0].admission_average; %>
    <% const avgCost = cost4[0].average_cost; %>
    <% const website = admissions4[0].website_url; %>
    <% const gradRate = grad4[0].grad_rate; %>

    <% const overall_rating = ratings4[0].overall; %>
    <% const academics_rating = ratings4[0].academics; %>
    <% const safety_rating = ratings4[0].safety; %>
    <% const party_rating = ratings4[0].partying; %>
    <% const food_rating = ratings4[0].cafeteria; %>
    <% const location_rating = ratings4[0].location; %>
    <% const happiness_rating = ratings4[0].happiness; %>
    <% const affordability_rating = ratings4[0].affordability; %>
    <% const employability_rating = ratings4[0].employability; %>

    <% const application_deadline = admissions4[0].application_deadline; %>
    <% const application_fee = admissions4[0].application_fee; %>
    <% const overall_average = admissions4[0].overall_average; %>
    <% const supplementary_application = admissions4[0].supplementary_application; %>

    <% const average_cost = cost4[0].average_cost; %>
    <% const average_housing_cost = cost4[0].average_housing_cost; %>
    <% const average_meal_plan_cost = cost4[0].average_meal_plan_cost; %>
    <% const average_domestic_tuition = cost4[0].average_domestic_tuition; %>
    <% const average_international_cost = cost4[0].average_international_cost; %>
    <% const books_supplies = data4[0].books_supplies; %>

    <% const employment_rate = grad4[0].employment_rate; %>
    <% const median_income = grad4[0].median_income; %>

    <div class="container-wrapper">
        <h1>Queens University</h1>
        
        <!-- Quick Facts Card -->
        <div class="uni-info-box">
            <h2>Quick Facts</h2>
            <div class="info-grid">
                <div class="info-item">
                    <h3>Avg. Admission</h3>
                    <p><%= admissionAvg %>%</p>
                </div>
                <div class="info-item">
                    <h3>Avg. Cost</h3>
                    <p>$<%= avgCost %></p>
                </div>
                <div class="info-item">
                    <h3>Graduation Rate</h3>
                    <p><%= gradRate %></p>
                </div>
                <div class="info-item">
                    <h3>Website</h3>
                    <a href="<%= website %>" target="_blank" style="color: #673ab7; font-weight: 600; text-decoration: none;">Queens</a>
                </div>
            </div>
        </div>

        <div class="uni-info-box">
            <h2>Student Ratings</h2>
            <div class="ratings-grid">
                <div class="mini-rating-card">
                    <h3>Overall</h3>
                    <p><%= overall_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Academics</h3>
                    <p><%= academics_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Safety</h3>
                    <p><%= safety_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Partying</h3>
                    <p><%= party_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Food</h3>
                    <p><%= food_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Location</h3>
                    <p><%= location_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Happiness</h3>
                    <p><%= happiness_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Affordability</h3>
                    <p><%= affordability_rating %></p>
                </div>
                <div class="mini-rating-card">
                    <h3>Employability</h3>
                    <p><%= employability_rating %></p>
                </div>
            </div>
        </div>

        <!-- Admissions Card -->
        <div class="uni-info-box">
            <h2>Admissions</h2>
            <div class="admissions-grid">
                <!-- Most important fields, styled as mini-cards -->
                <div class="important-info-card">
                    <h3>Application Deadline</h3>
                    <p><%= application_deadline %></p>
                </div>
                <div class="important-info-card">
                    <h3>Overall Average</h3>
                    <p><%= overall_average %>%</p>
                </div>
            </div>
            <ul>
                <li>
                    <strong>Application Fee:</strong> 
                    <span class="green-pill">$<%= application_fee %></span>
                </li>
                <li><strong>Application Website:</strong> <a href="<%= website %>" target="_blank" style="color: #673ab7; font-weight: 600; text-decoration: none;">Queens</a></li>
                <li><strong>Supplementary Application:</strong> Yes (highly considered)</li>
            </ul>
        </div>

        <!-- Cost of Living Card -->
        <div class="uni-info-box">
            <h2>Cost of Living</h2>
            <ul>
                <li class="cost-bar-container">
                    <strong class="cost-bar-label">Average Cost:</strong>
                    <div class="cost-bar-wrapper">
                        <div class="cost-bar" data-cost="<%= average_cost %>">
                            <span class="cost-value">$<%= average_cost %></span>
                        </div>
                    </div>
                </li>
                <li class="cost-bar-container">
                    <strong class="cost-bar-label">Average Housing Cost:</strong>
                    <div class="cost-bar-wrapper">
                        <div class="cost-bar" data-cost="<%= average_housing_cost %>">
                             <span class="cost-value">$<%= average_housing_cost %></span>
                        </div>
                    </div>
                </li>
                <li class="cost-bar-container">
                    <strong class="cost-bar-label">Average Meal Plan Cost:</strong>
                    <div class="cost-bar-wrapper">
                        <div class="cost-bar" data-cost="<%= average_meal_plan_cost %>">
                             <span class="cost-value">$<%= average_meal_plan_cost %></span>
                        </div>
                    </div>
                </li>
                <li class="cost-bar-container">
                    <strong class="cost-bar-label">Average Domestic Tuition:</strong>
                    <div class="cost-bar-wrapper">
                        <div class="cost-bar" data-cost="<%= average_domestic_tuition %>">
                             <span class="cost-value">$<%= average_domestic_tuition %></span>
                        </div>
                    </div>
                </li>
                <li class="cost-bar-container">
                    <strong class="cost-bar-label">Average International Tuition:</strong>
                    <div class="cost-bar-wrapper">
                        <div class="cost-bar" data-cost="<%= average_international_cost %>">
                             <span class="cost-value">$<%= average_international_cost %></span>
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <!-- Popular Majors Card -->
        <div class="uni-info-box">
            <h2>Popular Majors</h2>
            <ul>
                <% data4.forEach(row => { %>
                    <li><%= row.major_name %></li>
                <% }) %>
            </ul>
        </div>

        <!-- Residences Card with Grid Layout -->
        <div class="uni-info-box">
            <h2>Residences</h2>
            <div class="residence-grid residence-grid-header">
                <span>Name</span>
                <span>Room Type</span>
                <span>Capacity</span>
                <span>Price Range</span>
                <span>Rating</span>
            </div>
            <% residences4.forEach(row => { %>
                <div class="residence-grid residence-grid-row">
                    <span><%= row.residence_name %></span>
                    <span><%= row.room_type %></span>
                    <span><%= row.capacity %></span>
                    <span><%= row.price_range %></span>
                    <span><span class="rating-pill"><%= row.rating %></span></span>
                </div>
            <% }) %>
        </div>

        <!-- Post-Graduation Statistics Card -->
        <div class="uni-info-box">
            <h2>Post-Graduation</h2>
            <ul>
                <li><strong>Graduation Rate:</strong> <%= gradRate %></li>
                <li><strong>Employment Rate:</strong> <%= employment_rate %></li>
                <li><strong>Median Income:</strong> $<%= median_income %></li>
            </ul>
        </div>
    </div>

    <script>
        // This script runs after the HTML has been parsed by the browser.
        window.onload = function() {
            // Get all the cost bars by their class name
            const costBars = document.querySelectorAll('.cost-bar');

            // Set a maximum value to scale all the bars against.
            // This is the largest value in our dataset, which is the international tuition cost.
            const maxValue = 45000; 
            const minWidthPx = 80; // Minimum width for the bar to hold the text

            costBars.forEach(bar => {
                // Get the numerical cost value from the data attribute
                const cost = parseInt(bar.dataset.cost.replace(/,/g, ''), 10);
                
                // Calculate the percentage width
                let percentage = (cost / maxValue) * 100;
                
                // Apply a max width cap to the longest bar to ensure the text doesn't overflow
                if (percentage > 95) {
                    percentage = 95;
                }

                // Apply the calculated width to the element's style
                bar.style.width = `${percentage}%`;

                // Check if the calculated width is too small for the text
                const parentWidth = bar.parentElement.offsetWidth;
                const calculatedWidthPx = parentWidth * (percentage / 100);

                if (calculatedWidthPx < minWidthPx) {
                    bar.style.minWidth = `${minWidthPx}px`; // Force a minimum width
                    bar.classList.add('dark-text'); // Add a class to change text color
                } else {
                    bar.style.minWidth = ''; // Reset min-width
                    bar.classList.remove('dark-text'); // Remove the class
                }
            });
        };
    </script>

</body>